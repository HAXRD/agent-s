# 需求澄清结果

**日期：** 2025-11-07

## 1. K线图交互细节

### 1.1 鼠标悬浮显示信息
✅ **需要显示：**
- 当前价格
- 开盘价
- 最高价
- 最低价
- 收盘价
- 成交量
- 时间戳

### 1.2 成交量显示
✅ **是，显示在K线图下方**
- 成交量柱状图位于主K线图下方
- 与K线图共享时间轴
- 颜色与K线涨跌对应（绿色上涨，红色下跌）

### 1.3 价格标签
✅ **是，在图表上显示价格标签**
- 十字线跟随鼠标时，在图表上显示价格标签
- 右侧Y轴显示当前价格标签（红色高亮）

## 2. 代币对选择

### 2.1 交互方式
✅ **下拉选择框**

### 2.2 默认交易对
✅ **BTC/USDT**
- 初始加载时默认显示BTC/USDT

## 3. 时间粒度选择

### 3.1 交互方式
✅ **按钮组（1m, 5m, 1h）**
- 顶部左侧显示按钮组
- 当前选中的时间粒度高亮显示

### 3.2 切换时间粒度
✅ **是，从数据库重新查询**
- 切换时间粒度时，从数据库重新查询对应粒度的历史数据

## 4. 数据存储（技术决策）

### 4.1 K线数据存储粒度
✅ **存储所有时间粒度的K线数据**
- **原因：** 需要支持切换时间粒度时从数据库查询，如果只存储1分钟数据，切换时需要实时计算，增加复杂度
- **实现：** 为每个时间粒度（1m, 5m, 1h）分别存储K线数据

### 4.2 数据保留策略
✅ **永久保存**
- **原因：** 个人使用，数据量可控（3个交易对 × 3个时间粒度 = 9个数据流）
- **估算：** 每个交易对每天约1440条1分钟数据，数据量可接受

### 4.3 历史数据查询
✅ **查询所有历史数据**
- **原因：** 个人使用，数据量不大，查询所有历史数据性能可接受
- **实现：** 支持按时间范围查询，默认查询所有历史数据

## 5. 前端界面布局

### 5.1 页面布局
✅ **全屏K线图，控制栏在顶部**
- 主K线图占据界面大部分空间
- 控制栏在顶部（时间粒度选择、交易对信息、K线数据）
- 底部显示时间轴和控制选项

### 5.2 当前价格显示
✅ **在右侧Y轴上**
- 右侧Y轴显示价格范围
- 当前价格用红色标签高亮显示
- 有一条虚线横跨图表指示当前价格水平

## 6. 实时数据更新

### 6.1 WebSocket连接断开
✅ **自动重连**
- WebSocket连接断开时自动重连
- 显示连接状态提示

### 6.2 数据更新频率
✅ **节流更新**
- 节流更新（如每秒最多更新一次）
- 避免过于频繁的UI更新影响性能

## 7. 错误处理

### 7.1 API调用失败
✅ **多重处理：**
- 显示错误提示
- 静默重试
- 记录日志

### 7.2 数据库连接失败
✅ **多重处理：**
- 显示错误提示
- 继续运行（不存储数据，但实时数据仍可显示）

## 8. 视觉资产

✅ **已提供：**
- K线图参考设计/截图
- 界面布局参考

**参考设计特点：**
- 深色主题，界面简洁专业
- 顶部信息栏：时间粒度选择、交易对信息、K线详细数据
- 左侧工具栏：绘图和分析工具（MVP阶段可简化）
- 主K线图区域：占据大部分空间，显示K线数据
- 成交量图区域：位于K线图下方，显示成交量柱状图
- 底部控制栏：时间范围选择、当前时间等

